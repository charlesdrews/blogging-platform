<!DOCTYPE html>
{% autoescape true %}
<html>
  <head>
    <link type="text/css" rel="stylesheet" href="/stylesheets/main.css" />
  </head>
  <body>
 
  <div class="small">
    <a href="/">Charlie's Blogging Service</a> |
    {% if user %}{{ user.nickname() }} |{% endif %}
    <a href="{{ login_url }}">{{ login_text }}</a>
  </div>

  <table>
    <tr>
      <td colspan="2">
        <h1>{{ blog.name }}</h1>
        
        <hr>
        
        {% if user == blog.author %} 
          <h2>Welcome, {{ user.nickname() }}!</h2>
          <p>Please <a href="/createpost?blog_url_key={{ blog.key.urlsafe() }}">
          click here</a> to create a new post for this blog, or use the
          "edit post" links below to edit existing posts.</p>
          
          <hr>
        {% endif %}

      </td>
    </tr>
    <tr>
      <td>
        {% if selectedtag %}
          <p>Posts tagged with <b>{{ selectedtag }}</b>:
        {% endif %}
        
        {% for post in blog_posts %}
          <h2>{{ post.title }}</h2>

          <div class="small">
            By: {{ post.author }} |
            Posted: {{ post.create_date.strftime('%Y-%m-%d %H:%M') }} |
            Edited: {{ post.edit_date.strftime('%Y-%m-%d %H:%M') }}
          </div>

          <p>{{ post.body|safe }}

          <div class="small">
            Tags: 
            {% for tag in post.tags %}
               <a href="/blog?tag={{ tag }}&blog_url_key={{ blog.key.urlsafe() }}">
                  {{ tag }}</a>
               {%- if not loop.last %}, {% endif %}
            {% endfor %}
            <br>
            <a href="/post?post_url_key={{ post.key.urlsafe() }}">
               view full post</a>
            {% if user == blog.author %}| 
              <a href="/editpost?post_url_key={{ post.key.urlsafe() }}">
                 edit post</a>
            {% endif %}
          </div>

          {% if not loop.last %}<hr>{% endif %}
        {% endfor %}
        
        {% if more or selectedtag %}<hr>{% endif %}
        
        {% if more %}
          <div class="small">
            <a href="/blog?cursor={{ cursor }}&tag={{ selectedtag}}&blog_url_key={{ blog.key.urlsafe() }}">
               more posts</a>
           </div>
        {% endif %} 
         
        {% if selectedtag %}
          <div class="small">
            <a href="/blog?blog_url_key={{ blog.key.urlsafe() }}">
               Return to blog view (including all tags)</a>
          </div>
        {% endif %}

      </td>
      <td class="taglist">
      
        <br>Tags:
        <div class="small">
        {%- for tag in blogtags -%}
          <br>
          <a href="/blog?tag={{ tag }}&blog_url_key={{ blog.key.urlsafe() }}">
            {{ tag }}</a>
        {%- endfor -%}
        <br><br>
        <a href="/blog?blog_url_key={{ blog.key.urlsafe() }}">
           all tags</a>
        </div>
      
      </td>
    </tr>
  </table>
  </body>
</html>
{% endautoescape %}
