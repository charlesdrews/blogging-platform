<!DOCTYPE html>
{% autoescape true %}
<html>
  <head>
    <link type="text/css" rel="stylesheet" href="/stylesheets/main.css" />
  </head>
  <body>
  <table>
    <tr>
      <td colspan="2">
        <h1>{{ blog.name }}</h1>
        
        <hr>
        
        {% if user == blog.author %} 
          <h2>Welcome, {{ user.nickname() }}!</h2>
          <p>Please use this form to create a new post for "{{ blog.name }}",
             or edit an existing post by using one of the "edit post" links
             in the blog view below:
      
          <form action="/createpost" method="post">
            <input type=hidden name="blog_url_key" value="{{ blog.key.urlsafe() }}">
            <input type=hidden name="author" value="{{ user }}">
          
            <p>Post Title:<br>
            <textarea name="title" rows="2"></textarea>
          
            <p>Post Body:<br>
            <textarea name="body" rows="10"></textarea>
         
            <p>Tags (separated by commas):<br>
            <textarea name="tags" rows="2"></textarea>
           
            <p><input type="submit" value="Create Post">
          </form>
    
          <hr>
        
          Use the "edit post" links below to edit an existing post: 
        {% endif %}
      </td>
    </tr>
    <tr>
      <td>
        {% if selectedtag %}
          <p>Posts tagged with <b>{{ selectedtag }}</b>:
        {% endif %}
        
        {% for post in blog_posts %}
          <h2>{{ post.title }}</h2>
          <h3>By: {{ post.author }}</h3>

          <p>Posted: {{ post.create_date.strftime('%Y-%m-%d %H:%M:%S') }}
          <br>Edited: {{ post.edit_date.strftime('%Y-%m-%d %H:%M:%S') }}
          
          <p>{{ post.body }}

          <p>Tags: 
          {% for tag in post.tags %}
            <a href="/blog?tag={{ tag }}&blog_url_key={{ blog.key.urlsafe() }}">
                {{ tag }}</a>
            {% if not loop.last %},{% endif %}
          {% endfor %} 

          <p><a href="/post?post_url_key={{ post.key.urlsafe() }}">
                View full post</a>
        
          {% if user == blog.author %} 
            <p><a href="/editpost?post_url_key={{ post.key.urlsafe() }}">
                edit post</a>
          {% endif %}

          <hr>
        {% endfor %}
        
        {# more comes from ndb's fetch_page and indicates whether
           there are more results to show
        #}
        {% if more %}
          <p><a href="/blog?cursor={{ cursor }}&tag={{ selectedtag}}&blog_url_key={{ blog.key.urlsafe() }}">
                more posts</a>
        {% endif %} 
         
        {% if selectedtag %}
          <p><a href="/blog?blog_url_key={{ blog.key.urlsafe() }}">
                Return to blog view (including all tags)</a>
        {% endif %}

        <p><a href="/">Return to Charlie's Blogging Service homepage</a> 
      </td>
      <td class="taglist">
        <br>Tags:<br><br>
        list<br>
        will<br>
        go<br>
        here<br>
      </td>
    </tr>
  </table>
  </body>
</html>
{% endautoescape %}
